# shellcheck shell=dash

___x_cmd_claude_minimax(){
    local op="$1"
    case "$op" in
        -h|--help)      ___x_cmd help -m claude minimax; return 0 ;;
        --)             shift ;;
    esac

    local model=""
    local apikey=""
    local codingplan_apikey=""
    local endpoint=""
    local x_=""

    ___x_cmd minimax --cur model:=    apikey:=    codingplan_apikey:=     endpoint:=    2>/dev/null

    local apikey_to_request=""
    if [ -n "$codingplan_apikey" ]; then
        apikey_to_request="$codingplan_apikey"
        endpoint="https://api.minimaxi.com/anthropic"
    elif [ -n "$apikey" ]; then
        apikey_to_request="$apikey"
        [ -n "$endpoint" ] || endpoint="https://api.minimaxi.com/anthropic"
    else
        apikey_to_request="$ANTHROPIC_AUTH_TOKEN"
        [ -n "$apikey_to_request" ] || {
            claude:info \
                --tip1 'x minimax --cfg'                       \
                --tip2 'x minimax --cfg codingplan_apikey=<YOUR-CODING-PLAN-API-KEY>' \
                --tip2 'x minimax --cfg apikey=<YOUR-API-KEY>' \
                "Please setup MINIMAX API-KEY."
            return 1
        }
    fi

    [ -n "$model" ] || model="MiniMax-M2.1"

    local fast_model="${CLAUDE_CODE_SUBAGENT_MODEL:-$model}"
    # local nonessential_traffic="${CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC}"
    local nonessential_traffic="1"

    ANTHROPIC_API_KEY="" API_TIMEOUT_MS="3000000" ___x_cmd_claude_other___use "minimax" "$endpoint" "$apikey_to_request" "$model" "$fast_model" "$nonessential_traffic" "$@"
}


