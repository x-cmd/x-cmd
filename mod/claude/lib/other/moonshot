
# shellcheck shell=dash

___x_cmd_claude_moonshot(){
    local op="$1"
    case "$op" in
        -h|--help)      ___x_cmd help -m claude moonshot; return 0 ;;
        --)             shift ;;
    esac

    local model=""
    local apikey=""
    local endpoint=
    local x_=""

    ___x_cmd moonshot --cur model:= apikey:= endpoint:= 2>/dev/null
    [ -n "$model" ] || model="kimi-2.5"

    if [ -z "$apikey" ]; then
        apikey="$ANTHROPIC_AUTH_TOKEN"
        [ -n "$apikey" ] || {
            claude:warn \
                --tip1 'x moonshot --cfg'                       \
                --tip2 'x moonshot --cfg apikey=<YOUR-API-KEY>' \
                "Please setup moonshot API-KEY."
            return 1
        }
    fi

    local fast_model="${CLAUDE_CODE_SUBAGENT_MODEL:-$model}"
    local nonessential_traffic="${CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC}"

    case "$endpoint" in
        https://*.moonshot.ai/*)    endpoint="https://api.moonshot.ai/anthropic" ;;
        https://*.moonshot.cn/*|"") endpoint="https://api.moonshot.cn/anthropic" ;;
    esac

    ANTHROPIC_API_KEY="" ___x_cmd_claude_other___use "moonshot" "$endpoint" "$apikey" "$model" "$fast_model" "$nonessential_traffic" "$@"
}

