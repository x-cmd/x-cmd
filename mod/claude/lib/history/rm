
___x_cmd_claude_history_rm(){
    [ $# -gt 0 ]    ||  set - --help

    local mode="forced"
    while [ $# -gt 0 ]; do
        case "$1" in
            -h|--help)      ___x_cmd help -m claude history rm ; return 0;;
            -f|--forced)    shift; mode="forced"      ;;
            --dry-run)      shift; mode="dry_run"     ;;
            *)              break ;;
        esac
    done

    local i=;
    for i in "$@"; do
        ___x_cmd_claude_history_rm___"$mode" "$i" || return $?
    done
}


___x_cmd_claude_history_rm___forced(){
    local session_id="$1"

    claude:debug --session "$session_id" "Removing Claude history files."
    local history_path=
    ___x_cmd_claude_history_rm___dry_run | while read -r history_path; do
        ___x_cmd rmrf "$history_path" || return $?
    done

    claude:debug --session "$session_id" "Rewriting history.jsonl to remove records."
    ___x_cmd touch "$___X_CMD_CLAUDE_CODE_HOME_PATH/history.jsonl.x"
    ___x_cmd jq -c --arg sid "$session_id" '
        select(.sessionId? != $sid)
    ' "$___X_CMD_CLAUDE_CODE_HOME_PATH/history.jsonl" > "$___X_CMD_CLAUDE_CODE_HOME_PATH/history.jsonl.x" || return $?
    ___x_cmd mv "$___X_CMD_CLAUDE_CODE_HOME_PATH/history.jsonl.x" "$___X_CMD_CLAUDE_CODE_HOME_PATH/history.jsonl"

    claude:info --session "$session_id" "Claude history cleanup completed."
}

___x_cmd_claude_history_rm___dry_run(){
    local session_id="$1"
    [ -n "$session_id" ] || return 1
    ___x_cmd_cmds find "$___X_CMD_CLAUDE_CODE_DATA_PATH" -name "*${session_id}*"
}

