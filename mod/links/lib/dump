# shellcheck shell=dash

___x_cmd_links_dump(){
    # Enable in the future ...
    local codeurl=""
    local llmstxt=""
    local source=""

    local readable=""
    local trafi=""

    local cachetimeout=10m

    while [ $# -gt 0 ]; do
        case "$1" in
            -c|--codeurl)       codeurl=1   ;;
            -l|--llmstxt)       llmstxt=1   ;;
            -s|--source)        source=1    ;;

            -r|--readable)      readable=1  ;;
            -t|--trafi)         trafi=1  ;;

            -m|--markitdown)    markitdown=1  ;;

            --cache-timeout)    cachetimeout="$2"; arg:2:shift; continue ;;

            *)                  break ;;
        esac
        shift
    done

    local url="$1"

    local proxy
    local timeout

    ___x_cmd_links_cur  proxy:=  timeout:= 2>/dev/null

    if [ -n "$proxy" ]; then
        links:debug "Using proxy -> $proxy"
        ___x_cmd proxy run "$proxy" -- ___x_cmd_links_dump___run
    else
        ___x_cmd_links_dump___run
    fi
}


___x_cmd_links_dump___run(){
    if [ -n "$codeurl" ]; then
        local x_=""; ___x_cmd_links_codeurl_ "$url"

        local data
        if data="$(___x_cmd ccmd "$cachetimeout" -- ___x_cmd curl -s -L --fail "$x_")"; then
            printf "%s\n" "$data"
            return 0
        fi
    fi

    if [ -n "$llmstxt" ]; then
        local llmstxt_url="$url/llms.txt"
        local llms_data
        if llms_data="$(___x_cmd ccmd "$cachetimeout" -- curl -s -L --fail "$llmstxt_url")"; then
            printf "%s\n" "$llms_data"
            return 0
        fi
    fi

    if [ -z "$source" ]; then
        set -- -dump "$url"
    else
        set -- -source "$url"
    fi

    ___x_cmd ccmd "$cachetimeout" --  ___x_cmd_links___exec  "$@"

}
