# shellcheck shell=dash

___x_cmd_skill_rm(){
    local dir=""
    while [ "$#" -gt 0 ]; do
        case "$1" in
            -h|--help)      ___x_cmd help -m skill unuse;             return ;;
            --skill-dir)    [ -n "$2" ] || N=skill M="Please provide the skills dir" log:ret:64
                            dir="$2"; shift 2 ;;
            *)              break ;;
        esac
    done

    local i=;
    for i in "$@"; do
        case "$i" in
            mcp/*)  ___x_cmd_skill_rm___mcp "$i" || return $?           ;;
            *)      ___x_cmd_skill_rm___unit "$i" "$dir" || return $?   ;;
        esac
    done
}

___x_cmd_skill_rm___mcp(){
    local mcpid="$1"
    local name="${mcpid#mcp/*}"

    case "$dir" in
        *.claude/*)
                        ___x_cmd claude mcp remove "$name"  >/dev/null || return $?
                        skill:info "Successfully removed MCP[$mcpid]"                   ;;
        *.gemini/*)     N=skill M="Temporarily not supported -> gemini-cli" log:ret:64  ;;
        *.codex/*)      N=skill M="Temporarily not supported -> codex"      log:ret:64  ;;
    esac
}

___x_cmd_skill_rm___unit(){
    local skillid="$1"; [ -n "$skillid" ] || N=skill M="Please provide the skill id" log:ret:64
    local dir="$2";     [ -n "$dir" ]     || N=skill M="Please provide the dir" log:ret:64

    local x_=""; ___x_cmd_skill___get_name_or_id --getname-with-id "$skillid" || x_="$skillid"
    local target="$dir/$x_"
    skill:debug "Remove skill[$skillid] from directory -> $target"
    ___x_cmd rmrf "$target" || return $?

    skill:info "Successfully removed skill[$skillid]"
}
